<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Python Monty
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0d">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
          <!--<img src="https://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-xap1/v/t1.0-9/10565135_10103350446465307_2243295731634219240_n.jpg?oh=3ac00bd4b91147d87dcdde0c775d96a2&oe=551C5DF6&__gda__=1426461091_247303f7a3e20c9f3e67cef994dd2bf9" height="200"/>-->
      <h1>
        <a href="/">
          Python Monty
        </a>
      </h1>
      <p class="lead">Explaining the terrible code I write as I go. Mostly in Python</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item active" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    </nav>

    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/08/25/acorn-rino/">
        Acorn, RiNo, Denver
      </a>
    </h1>

    <span class="post-date">25 Aug 2015</span>

    <p>The drive to Acorn is unreal compared to other neighborhoods in Denver. Living in Englewood, I get a gradual shift to downtown - suburbs give way to rows of old bungalows, youthful hipster neighborhoods, then sports stadiums and high-rise apartments relective of the explosive urban growth experienced by Denver.</p>

<p>The drive from the north is diametrically different. Rolling foothills of wide-open prairiegrass are replaced by an ecstasy of interchanges, industrial buildings, train bridges, and warehouses. This is a gritter side of Denver, and feels very much like the Flats in my hometown of Cleveland. The conglomeration of skyscrapers in Denver push right up against this part of town, giving a feeling much like that of the Emerald City, like the buildings pushed up out of the ground, rainforest trees escaping a seedier understory.</p>

<p>This is River North - RiNo - and it&#39;s becoming one of my favorite neighborhoods here.</p>

<p>Pulling into The Source, which is as far as I can gather a market / coworking / shared business space for all things hipster and gentrified, I park in a dirt lot after driving down a street whose shoulders are also paved with dirt.</p>

<p>Acorn occupies a grafittied exposed-brick and corrugated-steel enclave of the building with an open front and patio. The countertops and seating are polished, refined matte black and the waitstaff and bartenders mirror the image. The menu is tapas-style, and worth the price.</p>

<p><strong>Fried Pickles with Green Goddess Aioli</strong></p>

<p>Not overdone. A good intro, but nothing to write home about.</p>

<p><strong>House-Made Gnocchi</strong></p>

<p>I am raving about these. The creme sauce is amazing - rich, thick, and seasoned perfectly with big, tangy salt flakes, it reminds me of clam chowder. Sharing the sauce are mushrooms bursting with flavor, smoky and tasting like they were roasted over the many logs of firewood stacked against the walls in here. These round out the clam portion of the chowder. The gnocchi are pan fried and starchy, completing the clam-chowder illusion. There&#39;s something lemony there that I can&#39;t quite place as well. Acorn has done very well on this dish.</p>

<p><strong>Razor Clam Ceviche</strong></p>

<p>I needed a third dish to fill me, but the heavy fried food and cream sauce left me desiring something lighter, of which there wasn&#39;t much that was also vegetarian.
The razor clam ceviche lacks the rich, briny flavor I usually seek in seafood. It&#39;s good, and light, but that bright ocean clarity wasn&#39;t around in my dish. It is, however, beautifully presented in a rigidly geometric arrangement, with straight and narrow razor clamshells at a rakish 45 degree offset from a square folded napkin, on which sits an ice bed.</p>

<p>The cocktail bar is alright, but not on the caliber of Merchant in Madison or the Upstairs in Boulder. The company was decidely in my bracket though - lots of 30-something young professionals and tattooed well-to-do creatives. I&#39;d recommend this restaurant to any struggling Denverite looking to go out with their parents, a troupe of acquaintances for after work, or the jetsetting, expense account (read: Epic) crowd.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/08/24/sing-a-song-for-sixpence/">
        Sexy Pizza
      </a>
    </h1>

    <span class="post-date">24 Aug 2015</span>

    <h2>Sexy Pizza - South Pearl, Denver</h2>

<p>I took a 5K sunset hike in Morrison, CO, today, a solid 20 minutes beyond surburban Denver and into the foothills. Afterwards, I was starving for an uncomplicated meal, and my friend Shauna has been after me to try Sexy Pizza for some time. It was right on the way home, so I stopped in. Pearl Street was unusually quiet so late at night, and I sat near the street in front of the wide-open garage door. An aside - it&#39;s very awkward to walk into a restaurant that has a normal door adjacent to an open garage door. Which is the right entrance?</p>

<p>It was nice seeing all the passersby, and the service staff was, like the restaurant, uncomplicated. They let me walk into the back unannounced to get a box at the end of the meal, they didn&#39;t bother me needlessly once my order was placed, and carried on lighthearted, boisterous conversation.</p>

<p>I can&#39;t express the same happiness for their product. Thick dough goes into a very hot brick-style oven, and the bottom of the crust takes on a Neapolitan crisp. The top of the dough stayed pillowy, however, and it made for a weird texture - too crunchy on the bottom, but underdone near the toppings. I do confess I ordered a lot of watery toppings in the form of a veggie pie, but the weird duality of the texture turned me off. My goal for my time in Denver is to not eat dinner at the same place twice - here&#39;s one I won&#39;t regret not visiting again.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/08/22/sexy-pizza/">
        Sing a Song for Sixpence
      </a>
    </h1>

    <span class="post-date">22 Aug 2015</span>

    <p>I&#39;ve been wanting to do this for some time, and I think I&#39;m taking the plunge - you&#39;ll start seeing restaurant reviews on here as well as code.</p>

<h2>Four and Twenty, East Johnson, Madison</h2>

<p>To start with, I can&#39;t believe I&#39;ve never been here. Well, actually, it stands to reason - Four and Twenty stands in a tiny commercial space amid tightly-knit ranch houses and sandwiched between the thoroughfares of East Wash and Packers Ave, so it&#39;s easy to drive right on past and not give it a second thought.</p>

<p>To do so would be a mistake. Mel and I were on our way to an art fair in the neighborhood and she commented that her friend Phil sometimes works here. We were looking for something small and quick to eat, and Four and Twenty fit the bill.</p>

<p>The cafe is small with big windows out onto a soccer field and a concrete patio with planters - in summer it&#39;s flooded with light, which illuminates all the imperfections (and the artwork) inside. The swinging doors to the kitchen don&#39;t completely block its view, nor that of the supply room, giving it a just-moved in feel.</p>

<p>Mel and I ordered breakfast sandwiches, and they were probably my ideal quick brunch if I could ever describe it. I had an egg and cheddar with spinach and sauteed mushrooms, on the second-best biscuit I&#39;ve ever had (that honor goes to Third &amp; Hollywood in Columbus). The biscuit was big and firm. It didn&#39;t flake off in layers or crumble in little ball-bearings of dough - it held together and didn&#39;t stick my tongue to the roof of my mouth. This biscuit is definitely something to write home about. A small cup of fruit accompanied the sandwich and made for a well-priced, well-portioned breakfast that didn&#39;t make me want to nap afterward.</p>

<p>I should also mention my drink, since it was even better than my sandwich - props to Phil. An iced chai latte with a rich milkiness that I&#39;m often lacking. It was understated and sweet and I&#39;d like to have another soon.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/16/a-homegrown-recipe-app-that-helps-you-cook/">
        A Homegrown Recipe App That Helps You Cook
      </a>
    </h1>

    <span class="post-date">16 Jan 2015</span>

    <p>I do love to cook. All of my favorite recipes are stored in my head, are improvised off the cuff, or found in a gross stack of crinkled papers held together with a binder clip in my cabinet.</p>

<p>I do a lot of looking up recipes online, but every recipe website I&#39;ve seen has a big flaw. These sites are not designed to help you actually read the recipe. They are designed to keep you clicking around, keep you sharing recipes on social media, keep you seeing ads.</p>

<p>I wanted a recipe app that would just show me what I needed to gather and how to put it together to cook it all. In the meantime, I decided it wouldn&#39;t hurt it if were also pretty to look at. Lastly, I wanted it optimized for use on an iPad so that I could keep it close at hand while actually cooking.</p>

<p><img src="https://raw.githubusercontent.com/z3ugma/rethink-recipes/master/screenshot1.png" alt="Finished Recipes Webapp"></p>

<h2>Technical Design</h2>

<p>Python is my pet language, and I wanted a database that would be easy to use with native Python types. Recipes are well-suited to a document-oriented store - each recipe has highly-variable ingredients. The only potential advantage I could see for a relational db would be to answer queries like &quot;show me all the recipes with onion as an ingredient&quot;. 
<a href="http://www.rethinkdb.com">RethinkDB</a> is great because it has a native web interface and a <a href="http://www.rethinkdb.com/docs/introduction-to-reql/">cool query language</a> called ReQL.</p>

<p>I used Python and Flask to write the app, and Tornado to make it easy to deploy - I can never seem to get uWSGI or Gunicorn working correctly.</p>

<h2>Frontend Design</h2>

<p>Two design elements set Rethink Recipes apart:</p>

<ol>
<li><p>When a recipe is entered, the app finds the top 8 Google Images hits for the title of the recipe. It uses the colors found in these images to calculate a <strong>unique, indivualized color palette</strong> for each recipe.</p></li>
<li><p>Whenever an ingredient appears verbatim in the directions, it is <strong>highlighted</strong> in the directions. This makes it easy to scan the directions for the step you should be on next.</p></li>
</ol>

<h2>App Routes</h2>

<p>Here are the nuts and bolts of how Rethink Recipes works:</p>

<h3>Adding a Recipe</h3>

<p><img src="https://raw.githubusercontent.com/z3ugma/rethink-recipes/master/screenshot3.png" alt="Adding a Recipe"></p>

<p>When accessing <strong>/add</strong>, the user is presented with 3 form fields - the title, ingredients, and directions.</p>

<p>When the form is submitted, a bunch of things happen:</p>

<ol>
<li>The title of the recipe is joined with + signs. i.e. &quot;Foo bar baz pancakes&quot; -&gt; &quot;foo+bar+baz+pancakes&quot;. This is the format the Google Images api receives queries in.</li>
<li>A Google Image API query returns a list of URLs pointing to Google Images thumbnails.</li>
<li>A Python module called Colorific, which uses PIL (the Python Image Library), extracts the most prominent colors from each image, 5 colors per image. (I also wrote my own module to do this processing, but Colorific was already packaged and easy to install. )</li>
<li>We&#39;re left with a list of RGB tuples. 5 colors per images times 8 images = 40 tuples long.</li>
<li>The Lightness value of each tuple is calculated (conversion to HSV color space), and the list is reordered in order of darkest to lightest.</li>
<li>The list is split into 4 smaller lists of 10 elements each. This roughly groups the colors into the 10 darkest, 10 next darkest, etc.</li>
<li>The average value of the 10 RGB tuples in each list is calculated. We end up with 4 tuples to store to the db along with the recipe.</li>
<li>The URL title is &quot;slugified&quot; - stripping out spaces and non alphanumeric punctuation to make a nice URL slug</li>
<li>The ingredients list is calculated. For each line in the ingredients box:

<ul>
<li>Split on spaces. The first 2 pieces are the amount - &quot;1 cup&quot; for example.</li>
<li>Everything after the amount is the &quot;what&quot;</li>
</ul></li>
<li>The directions list is each line of input in the dirctions box</li>
<li>All this data is formed into a Python dictionary:

<ul>
<li>Title, URLs of image thumbs, ingredients, directions, slug, and average colors.</li>
</ul></li>
<li>Ingredients and directions are sanitized for disallowed entries (like null string)</li>
<li>This Python dict is inserted into RethinkDB.</li>
<li>The user is redirected to the newly-created recipe.</li>
</ol>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_gimages</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;https://ajax.googleapis.com/ajax/services/search/images?v=1.0&amp;q=</span><span class="si">%s</span><span class="s">&amp;start=</span><span class="si">%d</span><span class="s">&amp;imgsz=large&amp;imgtype=photo&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">())[</span><span class="s">&#39;responseData&#39;</span><span class="p">][</span><span class="s">&#39;results&#39;</span><span class="p">]:</span>
             <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s">&#39;tbUrl&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">answer</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/add&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">RecipeForm</span><span class="p">()</span>
    <span class="c">#form.ingredients.data = &quot;1c ingredient\nenter ingredients here  &quot;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">validate</span><span class="p">():</span>

        <span class="n">lightness</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rainbow</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">resp</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="n">get_gimages</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">quiche</span> <span class="o">=</span> <span class="n">colorific</span><span class="o">.</span><span class="n">extract_colors</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">max_colors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">resp</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">each</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">quiche</span><span class="o">.</span><span class="n">colors</span><span class="p">])</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">m</span><span class="p">,</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.299</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.587</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.114</span> <span class="o">*</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">]</span>
        <span class="n">lightness</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lightness</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lightness</span><span class="p">]</span>
        <span class="n">lightness</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">rgb_to_hsv</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">tup</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">(</span><span class="n">lightness</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">avg</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">each</span><span class="p">)))</span>
            <span class="n">rainbow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>

        <span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="n">recipe</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">form</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="s">&#39;ingredients&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&#39;amount&#39;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ingredient</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span> <span class="s">&#39;what&#39;</span><span class="p">:</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ingredient</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:])}</span> <span class="k">for</span> <span class="n">ingredient</span> <span class="ow">in</span> <span class="n">form</span><span class="o">.</span><span class="n">ingredients</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)],</span> <span class="s">&#39;directions&#39;</span><span class="p">:</span> <span class="n">form</span><span class="o">.</span><span class="n">directions</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">),</span> <span class="s">&#39;urls&#39;</span><span class="p">:</span> <span class="n">urls</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="n">slug</span><span class="p">,</span> <span class="s">&#39;avgcolors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rainbow</span><span class="p">]}</span>

        <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;ingredients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;ingredients&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">[</span><span class="s">&#39;what&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">]</span>
        <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;directions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;directions&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">]</span>

        <span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;recipes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">recipe</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;recipe&#39;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">slug</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&quot;add.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span></code></pre></div>

<h3>Editing a Recipe</h3>

<p>The same form from /add is rendered, with the data from the existing recipe filled in. Once the form is submitted, the same process as adding happens. Instead of inserting the new recipe, however, the existing recipe&#39;s record is updated.</p>

<p>The slug of the recipe appears in the URL of the page. We use that slug to get the first recipe in the db that matches that slug. Note that there&#39;s no guarantee of uniqueness for a slug - RethinkDB doesn&#39;t have unique indexing.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&lt;query&gt;/edit&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>


    <span class="n">form</span> <span class="o">=</span> <span class="n">RecipeForm</span><span class="p">()</span>
    <span class="n">recipe</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;recipes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">({</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">recipe</span><span class="p">:</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">recipe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;GET&#39;</span><span class="p">:</span>

        <span class="n">form</span><span class="o">.</span><span class="n">ingredients</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="n">i</span><span class="p">[</span><span class="s">&#39;amount&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="s">&#39;what&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;ingredients&#39;</span><span class="p">]])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">directions</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;directions&#39;</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&quot;edit.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">recipe</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">id</span> <span class="o">=</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

        <span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;recipes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">recipe</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;recipe&#39;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">slug</span><span class="p">))</span></code></pre></div>

<h3>Deleting a Recipe</h3>

<p><img src="https://raw.githubusercontent.com/z3ugma/rethink-recipes/master/screenshot4.png" alt="Deleting a Recipe"></p>

<p>The recipe&#39;s slug is in the URL. The user clicks &quot;Delete&quot;, is prompted with a checkbox to confirm, and then recipes with slugs matching the URL are deleted:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&lt;query&gt;/delete&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">DeleteForm</span><span class="p">()</span>
    <span class="n">recipe</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;recipes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">({</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">recipe</span><span class="p">:</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">recipe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;GET&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&quot;delete.html&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">recipe</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;deleterecipe&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>

            <span class="nb">id</span> <span class="o">=</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

            <span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;recipes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">&quot;Are you sure? Check the box&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&quot;delete.html&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">recipe</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span></code></pre></div>

<h3>Displaying a Recipe</h3>

<p>When a recipe&#39;s slug appears alone in the URL, the recipe is displayed.</p>

<p>The first recipe in the db with a matching slug is displayed. We take the &quot;what&quot; from each ingredient, and only take the portion before a comma. This allows for things like &quot;onions, diced&quot; to appear in the recipe, but still highlight the word &quot;onions&quot; in the directions. If the word appears in the directions, then the word in the directions is wrapped in kbd tags, which stand out in Bootstrap.</p>

<p>You&#39;ll recall that each recipe has 8 URLs of Google images and 4 RBG tuples of colors to use in displaying the page. When the page is rendered, the darkest of the RGB colors is used as the background of the header, the lightest is used for the page background and header text, and the 2nd darkest is used for the panel headers. The 4th one is reserved for future use.</p>

<p>Along with the 8 Google images thumbnails in place, this makes each recipe page have the unique colors corresponding to the food you&#39;re making! So a raspberry pie has bright reds and rich tans, and a chili recipe has lots of earthy tones.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&lt;query&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">recipe</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="n">recipe</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;recipes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">({</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">recipe</span><span class="p">:</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">recipe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>

    <span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;directions&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="s">&#39;what&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;ingredients&#39;</span><span class="p">]]:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;&lt;kbd&gt;&quot;</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s">&quot;&lt;/kbd&gt;&quot;</span><span class="p">))</span>
        <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Markup</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="n">rainbow</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;avgcolors&#39;</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&quot;recipes.html&quot;</span><span class="p">,</span> <span class="n">urls</span> <span class="o">=</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;urls&#39;</span><span class="p">],</span> <span class="n">avg</span><span class="o">=</span><span class="n">rainbow</span><span class="p">,</span> <span class="n">ingredients</span> <span class="o">=</span> <span class="n">recipe</span><span class="p">[</span><span class="s">&#39;ingredients&#39;</span><span class="p">],</span> <span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">recipe</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">)</span></code></pre></div>

<p>The end result of this is an iPad-optimized recipe database, customizable for your own personal recipes. Not great for importing directly from recipe sites, but great for saving your time-tested recipes in a user-friendly format.</p>

<h3>Futures</h3>

<p>I would like to expand this to being multi-user. I think each user would get their own RethinkDB table, and add a users table with hashed passwords.</p>

<h3>Check It Out</h3>

<p>You can download and set it up for yourself in a virtual machine - see the <a href="https://github.com/z3ugma/rethink-recipes">Github repo for the project</a></p>

<p>You can also see my local copy of the app, at <a href="http://z3ugma.zzzz.io:5025">http://z3ugma.zzzz.io:5025</a>. Feel free to add your own recipes, but don&#39;t delete mine :)</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/16/delicious-vegan-biscuits-and-gravy%20copy/">
        Delicious Vegan Biscuits and Gravy
      </a>
    </h1>

    <span class="post-date">16 Jan 2015</span>

    <p>Next up, a departure from my usual programming entries to another hobby - cooking.</p>

<p>It&#39;s <a href="http://www.veganuary.com">Veganuary</a>! It&#39;s a month of sacrifice for me, in the name of shedding holiday pounds.</p>

<p>The single hardest thing for me about going vegan is finding quick meals to make that aren&#39;t a piece of fruit. </p>

<p>I think it&#39;s similar to when I stopped eating meat. At first, I started cooking the same old meals, just with the meat removed and a vegetable or mushrooms substituted. These sometimes felt lacking. Over time, I learned to cook &quot;natively veggie&quot; meals - meals that were vegetarian from the start, whose flavors melded and combined deliciously without the need for meat.</p>

<p>Now that I&#39;m not eating dairy or cheese, I find my usual meals lacking - because there&#39;s no dairy or cheese. It will take some time to learn to cook &quot;natively vegan&quot;, I&#39;m sure.</p>

<p>In the meantime, however, here&#39;s an amazing, hearty, breakfast, that&#39;s totally vegan.</p>

<h1>Vegan Biscuits and Gravy</h1>

<p><em>Serves 4</em></p>

<h2>Ingredients</h2>

<ul>
<li>12 oz Trader Joe&#39;s Soy Chorizo</li>
<li>1 medium yellow onion, diced</li>
<li>1 green bell pepper, diced</li>
<li>2 oz Earth Balance buttery vegan spread</li>
<li>2 oz whole wheat flour</li>
<li>1 Tbsp Better than Bouillon No-Beef Base</li>
<li>Garlic Naan or vegan english muffins</li>
</ul>

<h2>Directions</h2>

<ol>
<li>With a little olive oil, brown the chorizo, onions, and peppers in a large skillet. Once browned, move the mixture to one half of the pan.</li>
<li>Melt the earth balance in the empty half of the pan. Add the flour and whisk lightly until a pasty consistency is achieved. Allow this roux to brown for a minute.</li>
<li>Mix bouillon and 1 cup of water. Add to the roux a little bit at a time, whisking constantly until gravy-like. Mix the chorizo mixture in with the broth. Add water to thin to your liking.</li>
<li>Toast the garlic naan or english muffin. Slice into thin wafers and top the bread with biscuits and gravy. Yum!</li>
</ol>

<p><img src="/images/vegan_gravy.jpg" alt="Vegan Biscuits and Gravy"></p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>
    </div>

  </body>
</html>
